# Remnawave Node Agent — пример .env
# Скопируйте в .env и заполните значения

# UUID ноды (из Remnawave / Admin Bot)
AGENT_NODE_UUID=your-node-uuid-here

# URL Collector API (Web Backend), без trailing slash
# Локально: http://host.docker.internal:8081
# Docker: http://remnawave-web-backend:8081
# Продакшен: https://admin.yourdomain.com (через reverse proxy)
AGENT_COLLECTOR_URL=http://localhost:8081

# Токен агента (выдаётся в веб-панели или Admin Bot для этой ноды)
AGENT_AUTH_TOKEN=your-agent-token-here

# Интервал отправки батчей (секунды)
# В real-time режиме используется для отправки накопленных подключений
AGENT_INTERVAL_SECONDS=30

# Режим парсинга логов: "polling" (периодический опрос) или "realtime" (отслеживание новых строк)
# realtime - читает только новые строки, быстрее и эффективнее (рекомендуется)
# polling - читает последние N байт каждые interval_seconds (старый режим)
AGENT_LOG_PARSING_MODE=realtime

# Интервал проверки новых строк в real-time режиме (секунды)
# Может быть меньше AGENT_INTERVAL_SECONDS для более быстрой реакции
# По умолчанию равен AGENT_INTERVAL_SECONDS
# Пример: AGENT_REALTIME_CHECK_INTERVAL_SECONDS=5 (проверка каждые 5 сек, отправка каждые 30 сек)
# AGENT_REALTIME_CHECK_INTERVAL_SECONDS=30

# Путь к access.log на ноде (Remnawave: /var/log/remnanode/access.log)
# В Docker монтировать том с логами
AGENT_XRAY_LOG_PATH=/var/log/remnanode/access.log

# Максимальный размер буфера накопленных подключений (защита от утечки памяти)
# Если Collector API недоступен, буфер не будет расти бесконечно
# AGENT_MAX_BUFFER_SIZE=50000

# Retry при отправке в Collector
# AGENT_SEND_MAX_RETRIES=3
# AGENT_SEND_RETRY_DELAY_SECONDS=5.0

# Опционально: уровень логов (DEBUG, INFO, WARNING, ERROR)
# Для диагностики проблем установи DEBUG
AGENT_LOG_LEVEL=INFO

# Автоматический перезапуск агента каждые N часов (для предотвращения утечки памяти)
# Docker restart: unless-stopped автоматически перезапустит контейнер
# 0 = без ограничения
AGENT_MAX_UPTIME_HOURS=6

# ============================================
# Agent v2: Command Channel (опционально)
# ============================================
# WebSocket-канал для приёма команд от веб-панели (терминал, скрипты, провижининг).
# По умолчанию выключен — агент работает только в режиме сбора метрик.
#
# Для включения:
# 1. Установите AGENT_COMMAND_ENABLED=true
# 2. Укажите AGENT_WS_SECRET_KEY — должен совпадать с WEB_SECRET_KEY на бэкенде
#    (используется для HMAC-подписи команд, агент проверяет подпись перед выполнением)

# AGENT_COMMAND_ENABLED=false

# WebSocket URL (опционально, по умолчанию берётся из AGENT_COLLECTOR_URL)
# Указывайте только если WebSocket endpoint отличается от Collector API
# AGENT_WS_URL=wss://admin.yourdomain.com

# Секретный ключ для проверки HMAC-подписи команд
# ОБЯЗАТЕЛЬНО при AGENT_COMMAND_ENABLED=true
# Должен совпадать с WEB_SECRET_KEY в .env основного проекта
# AGENT_WS_SECRET_KEY=your_web_secret_key_here
