services:
  node-agent:
    image: ghcr.io/case211/remnawave-admin-node-agent:latest
    container_name: remnawave-node-agent
    restart: unless-stopped
    env_file:
      - .env
    # Host mode: позволяет выполнять скрипты и терминал на хосте.
    # Включите AGENT_HOST_MODE=true в .env для активации.
    pid: "host"
    privileged: true
    volumes:
      - /var/log/remnanode:/var/log/remnanode:ro
      - ./logs:/app/logs
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - remnawave-network
    deploy:
      resources:
        limits:
          memory: 128M
          cpus: "0.5"
        reservations:
          memory: 32M
          
    healthcheck:
      test: ["CMD-SHELL", "pgrep -f 'python -m src.main' || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
      
    stop_grace_period: 15s
    
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  remnawave-network:
    external: true
